<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Customer Homepage</title>

  <script>
    const user = localStorage.getItem("user");
    if (!user) {
      window.location.href = "login.html"; // redirect if not logged in
    }
  </script>

  <!--Font Awesome-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha512-DxV+EoADOkOygM4IR9yXP8Sb2qwgidEmeqAEmDKIOfPRQZOWbXCzLC6vjbZyy0vPisbH2SyW27+ddLVCN+OMzQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <!--TailWind CSS CDN-->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <!-- Sidebar -->
  <nav class="fixed top-0 left-0 h-full w-56 bg-orange-600 flex flex-col justify-between py-6">
    <div>
      <!-- Logo -->
      <div class="flex justify-center mb-6">
        <img src="../../images/Logo/BarDeli.png" class="h-24 w-auto" alt="Logo">
      </div>

      <!-- Navigation Links -->
      <div class="flex flex-col space-y-2">
        <a href="customerhomepage.html" class="flex items-center gap-3 px-4 py-3 text-white font-bold rounded bg-orange-800">
          <i class="fa-regular fa-house"></i> Home
        </a>
        <a href="customerbookingpage.html" class="flex items-center gap-3 px-4 py-3 text-white font-bold rounded hover:bg-orange-500">
          <i class="fa-regular fa-calendar"></i> Booking
        </a>
        <a href="customernotificationspage.html" class="flex items-center gap-3 px-4 py-3 text-white font-bold rounded hover:bg-orange-500">
          <i class="fa-regular fa-bell"></i> Notifications
        </a>
        <a href="customerprofilepage.html" class="flex items-center gap-3 px-4 py-3 text-white font-bold rounded hover:bg-orange-500">
          <i class="fa-regular fa-user"></i> Profile
        </a>
      </div>
    </div>

    <!-- Logout -->
    <div class="flex justify-center">
      <button id="logoutBtn" class="flex items-center gap-3 px-4 py-3 text-white font-bold rounded hover:bg-orange-500">
        <i class="fa-solid fa-arrow-right-from-bracket"></i> Logout
      </button>
    </div>
  </nav>

  <!--Customer Dashboard-->
  <main class="ml-56 p-8 fixed w-[calc(100%-14rem)]">
    <h1 class="text-5xl font-black text-orange-600">Welcome <span id="customerName">Loading...</span></h1>
    <p class="text-sm font-bold text-orange-600 mt-[10px]">Here's an overview of your catering bookings</p>

    <!--Summary Blocks-->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
      <div class="bg-orange-600 p-6 rounded-xl flex justify-between items-center">
        <div>
          <div class="w-full flex items-center">
            <h2 class="text-3xl font-black text-white w-full">Total Bookings</h2>
            <i class="fa-regular fa-calendar text-white text-4xl ml-[390px]"></i>
          </div>
          <p id="totalBookings" class="text-[64px] text-white font-black mb-[10px]">0</p>
          <p class="text-lg text-white">Events successfully booked</p>
        </div>
      </div>
      <div class="bg-orange-600 p-6 rounded-xl flex justify-between items-center">
        <div>
          <div class="w-full flex items-center mb-5">
            <h2 class="text-3xl font-black text-white w-full">Last Booking</h2>
            <i class="fa-regular fa-clock text-white text-4xl ml-[400px]"></i>
          </div>

          <p id="lastDate" class="text-lg font-bold text-white mb-3">Date: none</p>
          <p id="lastGuests" class="text-lg font-bold text-white mb-3">Number of Guests: none</p>
          <p id="lastLocation" class="text-lg font-bold text-white">Location: none</p>

        </div>
      </div>
    </div>

    <!-- Recent Bookings -->
    <div class="bg-orange-600 rounded-xl mt-8 p-6 h-[570px]">
      <h2 class="text-3xl text-white font-bold mb-4">Recent Bookings</h2>
      <div id="Recent-bookings" class="overflow-auto h-[450px] w-[100%] p-3 text-white">
        <!-- Bookings Cards will load here -->
      </div>
    </div>
  </main>

  <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

    const supabaseUrl = "https://fawlfsukrqrucrrxrjvq.supabase.co";
    const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZhd2xmc3VrcnFydWNycnhyanZxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU0MzU2OTUsImV4cCI6MjA3MTAxMTY5NX0.KGH5SAJvCEhnz3NHdp6LeMgCvZp-nP1Tj6oIL32J6K8";
    const supabase = createClient(supabaseUrl, supabaseKey);

    const userData = JSON.parse(localStorage.getItem("user"));

    // Update Dashboard Name
document.getElementById("customerName").textContent = userData?.fullname || "Customer";

// Load bookings
async function loadBookings() {
  if (!userData?.id) {
    console.error("User data not available");
    return;
  }

  try {
    const { data: bookings, error } = await supabase
      .from("booking")
      .select("*")
      .eq("userid", Number(userData.id))
      .order("eventdate", { ascending: false });

    if (error) {
      console.error("Error fetching bookings:", error);
      // Set default values when there's an error
      document.getElementById("totalBookings").textContent = "0";
      document.getElementById("lastDate").textContent = "Date: none";
      document.getElementById("lastGuests").textContent = "Number of Guests: none";
      document.getElementById("lastLocation").textContent = "Location: none";
      return;
    }

    // Total Bookings
    document.getElementById("totalBookings").textContent = bookings?.length || 0;

    // Last Booking
    const lastBooking = bookings?.[0];
    document.getElementById("lastDate").textContent = `Date: ${lastBooking?.eventdate || "none"}`;
    document.getElementById("lastGuests").textContent = `Number of Guests: ${lastBooking?.guestcount || "none"}`;
    document.getElementById("lastLocation").textContent = `Location: ${lastBooking?.location || "none"}`;

    // Recent Bookings
    const recentDiv = document.getElementById("Recent-bookings");
    if (recentDiv) {
      recentDiv.innerHTML = "";

      bookings?.forEach(b => {
        const card = `
          <div class="bg-orange-400 rounded-xl p-4 mb-4 flex flex-col gap-2 relative">
            <span class="absolute top-3 right-3 bg-orange-700 font-bold px-3 py-1 rounded-lg text-sm">${b.eventtype || 'Event'}</span>
            <p class="absolute top-3 left-3 font-bold text-2xl flex justify-center text-center">
              <i class="fa-regular fa-calendar text-3xl mr-1"></i> Event Date: ${b.eventdate || 'TBD'}
            </p>
            <div class="grid grid-cols-2 gap-x-6 p-1 mt-10">
              <p class="font-bold mb-2"><i class="fa-solid fa-users mr-1.5"></i> Number of Guests: ${b.guestcount || 0} Guests</p>
              <p class="font-bold mb-2"><i class="fa-solid fa-utensils mr-1.5"></i> Menu Type: ${b.menu_type || 'Standard'}</p>
              <p class="font-bold"><i class="fa-solid fa-location-dot mr-1.5"></i> Event Location: ${b.location || 'TBD'}</p>
              <p class="font-bold"><i class="fa-regular fa-clock mr-1.5"></i> Event Time: ${b.eventtime || 'TBD'}</p>
            </div>
          </div>
        `;
        recentDiv.insertAdjacentHTML("beforeend", card);
      });
    }
  } catch (err) {
    console.error("Unexpected error loading bookings:", err);
  }
}

// Call the functions
loadBookings();
  </script>
</body>
</html>




