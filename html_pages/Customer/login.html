<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Bardeli Login</title>
	<!-- Fixed: Correct path from html_pages/login.html to css_pages/ -->
	<link rel="stylesheet" href="../../css_pages/Customer/login.css">
</head>
<body>
	<!-- Navigation -->
	<nav class="navbar">
		<div class="logo">
			<!-- Fixed: Correct path from html_pages/login.html to images/ -->
			<img src="../../images/Logo/BarDeli.png" alt="Company Logo">
		</div>
		<!-- Add home button -->
		<a href="../../index.html" style="color: white; text-decoration: none; margin-left: auto;">Home</a>
	</nav>
	
	<!-- Login Section -->
	<div class="login-section">
		<div class="login-content">
			<h1>Login</h1>
			<div class="login-inputs">
				<p>Email:</p>
				<input type="text" id="email" placeholder="Please enter your email">
	
				<p>Password:</p>
				<input type="password" id="password" placeholder="Please enter your password">
				<div class="password-checkbox">
					<input type="checkbox" id="password-chkbox">
					<label for="password-chkbox"> Show Password</label><br>
				</div>

				<div class="login-button">
					<!-- Fixed: Removed direct redirect onclick -->
					<button id="loginBtn" type="button">Login</button>
				</div>

				<div class="signup">
					<p>Don't have a profile?</p>
					<div class="signup-button">
						<!-- Fixed: Correct path from html_pages/login.html to signup.html -->
						<button onclick="window.location.href='signup.html'">Sign Up</button>
					</div>
				</div>
			</div>
		</div>
	</div>
	
	<!-- Footer -->
	<footer>
		<p>Â© 2025 Bardeli Catering</p>
	</footer>
	
	<!-- Script -->
	<script type="module">
		import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';
		const supabaseUrl = 'https://fawlfsukrqrucrrxrjvq.supabase.co';
		const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZhd2xmc3VrcnFydWNycnhyanZxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU0MzU2OTUsImV4cCI6MjA3MTAxMTY5NX0.KGH5SAJvCEhnz3NHdp6LeMgCvZp-nP1Tj6oIL32J6K8';
		const supabase = createClient(supabaseUrl, supabaseKey);
		
		// Show/Hide password
		document.getElementById("password-chkbox").addEventListener("click", () => {
			let x = document.getElementById("password");
			x.type = x.type === "password" ? "text" : "password";
		});
		
		// Login check (plaintext version for now)
		async function login() {
			const email = document.getElementById("email").value.trim();
			const password = document.getElementById("password").value.trim();
			
			if (!email || !password) {
				alert("Please enter both email and password");
				return;
			}
			
			try {
				const { data, error } = await supabase
					.from('users')
					.select('*')
					.eq('email', email)
					.single();
				
				if (error || !data) {
					alert('User not found');
					console.error('Supabase error:', error);
					return;
				}
				
				if (data.passwordhash === password) {
  alert('Login successful!');
  
  // Save user info (at least email or id)
  localStorage.setItem("user", JSON.stringify({
    id: data.id,
    email: data.email,
	fullname: data.fullname
  }));

  window.location.href = 'customerhomepage.html';


				} 
				else {
					alert('Incorrect password');
				}
			} catch (err) {
				alert('Login error: ' + err.message);
				console.error('Login error:', err);
			}
		}
		
		document.getElementById("loginBtn").addEventListener("click", login);
	</script>
</body>
</html>
