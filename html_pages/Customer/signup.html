<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bardeli Sign Up</title>
    <!-- Fixed CSS path -->
    <link rel="stylesheet" href="../../css_pages/signup.css">
</head>
<body>
    <nav class="navbar">
        <div class="logo">
            <!-- Fixed image path -->
            <img src="../../images/Logo/BarDeli.png" alt="Company Logo">
            <span style="display: none;">üçΩÔ∏è BarDeli Catering</span>
        </div>
    </nav>
    
    <div class="signup-section">
        <div class="signup-content">
            <h1>Sign Up</h1>
            <div class="signup-inputs">
                <form id="signupForm">
                    <p>Full Name:</p>
                    <input type="text" id="fullname" placeholder="Please enter your name and surname" required>
                    
                    <p>Phone:</p>
                    <input type="tel" id="phone" placeholder="Please enter your phone number, eg: 079 121 2348" required>
                    
                    <p>Role:</p>
                    <select id="role" required>
                        <option value="Customer">Customer</option>
                    </select>
                    
                    <p>Email:</p>
                    <input type="email" id="email" placeholder="Please enter your email" required>
                    
                    <p>Password:</p>
                    <input type="password" id="password" placeholder="Please enter a password" required>
                    <div class="password-checkbox">
                        <input type="checkbox" id="password-chkbox" name="password-chkbox" onclick="showPassword()">
                        <label for="password-chkbox">Show Password</label>
                    </div>
                </form>
                <div class="signup-button">
                    <button id="signup">Sign Up</button>
                </div>
            </div>
        </div>
    </div>
    
    <footer>
        <p>¬© 2025 Bardeli Catering</p>
    </footer>

    <!-- Password toggle function -->
    <script>
        function showPassword() {
            let x = document.getElementById("password");
            x.type = x.type === "password" ? "text" : "password";
        }
    </script>

    <!-- Supabase signup handler with console logging -->
    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

        const supabaseUrl = 'https://fawlfsukrqrucrrxrjvq.supabase.co'
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZhd2xmc3VrcnFydWNycnhyanZxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU0MzU2OTUsImV4cCI6MjA3MTAxMTY5NX0.KGH5SAJvCEhnz3NHdp6LeMgCvZp-nP1Tj6oIL32J6K8'

        const supabase = createClient(supabaseUrl, supabaseKey)

        document.addEventListener('DOMContentLoaded', function() {
            const signupButton = document.getElementById('signup')
            const fullname = document.getElementById('fullname')
            const phone = document.getElementById('phone')
            const role = document.getElementById('role')
            const email = document.getElementById('email')
            const password = document.getElementById('password')

            signupButton.addEventListener('click', async (e) => {
                e.preventDefault()

                if (!fullname.value || !phone.value || !email.value || !password.value) {
                    alert('Please fill in all fields');
                    return;
                }

                signupButton.disabled = true;
                signupButton.textContent = 'Signing up...';

                try {
                    const { data, error } = await supabase
                        .from('customerAccounts')
                        .insert([{
                            fullname: fullname.value,
                            phone: phone.value,
                            role: role.value,
                            email: email.value,
                            passwordhash: password.value
                        }])

                    console.log('Supabase Response Data:', data)
                    console.log('Supabase Response Error:', error)

                    if (error) {
                        alert('Signup failed: ' + error.message)
                    } else {
                        alert('Signup successful! Redirecting to login...')
                       window.location.href = "login.html";
                    }
                } catch (err) {
                    console.error('Unexpected error:', err)
                    alert('An unexpected error occurred: ' + err.message)
                } finally {
                    signupButton.disabled = false;
                    signupButton.textContent = 'Sign Up';
                }
            })
        })
    </script>
</body>
</html>
