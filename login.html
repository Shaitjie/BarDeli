<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Bardeli Login</title>
	<script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="font-sans bg-white">

	<!-- Navigation -->
	<nav class="fixed top-0 left-0 w-full bg-[#d35400] flex justify-between items-center h-20 z-50 shadow-md px-5">
		<div class="flex items-center">
			<img onclick="window.location.href='index.html'" src="./images/BarDeli Logo (White).png"
				alt="Company Logo" class="h-20 mr-2 cursor-pointer">
		</div>
	</nav>

	<!-- Login Section -->
	<div class="w-full mt-28 text-center">
		<div class="w-4/5 h-[740px] bg-[#d35400] inline-block rounded-2xl text-left px-64 py-4">
			<h1 class="text-[60px] font-black text-center text-white">Login</h1>

			<div class="login-inputs">
				<p class="text-left text-[35px] mt-6 font-extrabold text-white">Email:</p>
				<input type="text" id="email" placeholder="Please enter your email"
					class="w-full h-[75px] rounded-2xl border border-black text-[35px] text-left px-4 font-semibold">

				<p class="text-left text-[35px] mt-6 font-extrabold text-white">Password:</p>
				<input type="password" id="password" placeholder="Please enter your password"
					class="w-full h-[75px] rounded-2xl border border-black text-[35px] text-left px-4 font-semibold">

				<div class="flex items-center gap-2 mt-4">
					<input type="checkbox" id="password-chkbox" class="w-[18px] h-[30px]">
					<label for="password-chkbox" class="text-sm font-extrabold text-white">Show Password</label>
				</div>

				<div class="w-full mt-8">
					<button id="loginBtn" type="button"
						class="w-full h-20 text-5xl font-extrabold rounded-2xl text-[#d35400] bg-white border border-transparent transition duration-300 hover:text-white hover:bg-[#d35400] hover:border-white">
						Login
					</button>
				</div>

				<div class="mt-6 inline-flex items-center">
					<p class="text-white font-extrabold text-2xl">Don't have a profile?</p>
					<div class="ml-4">
						<button onclick="window.location.href='signup.html'"
							class="text-[35px] px-2 py-0.5 ml-4 text-[#d35400] bg-white border-none rounded-2xl font-extrabold mt-2 w-[234px] transition duration-300 hover:bg-[#d35400] hover:text-white hover:border hover:border-white">
							Sign Up
						</button>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Footer -->
	<footer
		class="fixed bottom-0 w-full bg-[#d35400] text-white text-center py-4 h-20 flex justify-center items-center">
		<p class="text-[32px] font-extrabold">© 2025 Bardeli Catering</p>
	</footer>

	<!-- Login with Supabase auth -->
	<script type="module">
		import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

        const supabaseUrl = 'https://fawlfsukrqrucrrxrjvq.supabase.co'
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZhd2xmc3VrcnFydWNycnhyanZxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU0MzU2OTUsImV4cCI6MjA3MTAxMTY5NX0.KGH5SAJvCEhnz3NHdp6LeMgCvZp-nP1Tj6oIL32J6K8'

        export const supabase = createClient(supabaseUrl, supabaseKey)

		document.getElementById("password-chkbox").addEventListener("click", () => {
			let x = document.getElementById("password");
			x.type = x.type === "password" ? "text" : "password";
		});

		async function login() {
			const email = document.getElementById("email").value.trim();
			const password = document.getElementById("password").value.trim();

			if (!email || !password) {
				alert("Please enter both email and password");
				return;
			}

			try {
				// 1️⃣ Sign in with Supabase Auth
				const { data: authData, error: authError } = await supabase.auth.signInWithPassword({
					email,
					password
				});

				if (authError) throw authError;

				// 2️⃣ Fetch user info from your users table
				const { data: userData, error: userError } = await supabase
					.from('users')
					.select('*')
					.eq('auth_user_id', authData.user.id)
					.single();

				if (userError) throw userError;

				// 3️⃣ Store session info in localStorage (optional)
				localStorage.setItem("user", JSON.stringify({
					id: userData.id,
					email: email,
					first_name: userData.first_name,
					last_name: userData.last_name,
					role: userData.role
				}));

				if (userData.role === "Customer") {
					window.location.href = './html_pages/Customer/customerhomepage.html';
				} else if (userData.role === "Admin") {
					window.location.href = './admin/admin-dashboard.html';
				} else {
					alert("Unknown role. Please contact support.");
				}

			} catch (err) {
				console.error('Login error:', err);
				alert('Login failed: ' + err.message);
			}
		}

		document.getElementById("loginBtn").addEventListener("click", login);
	</script>

</body>

</html>
