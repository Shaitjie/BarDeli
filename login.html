<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Bardeli Login</title>
	<script src="https://cdn.tailwindcss.com"></script>
	<script>
		tailwind.config = {
			theme: {
				extend: {
					colors: {
						brand: "#FB8C00", // Brand Orange
					},
				},
			},
		};
	</script>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css"
		integrity="sha512-2SwdPD6INVrV/lHTZbO2nodKhrnDdJK9/kg2XD1r9uGqPo1cUbujc+IYdlYdEErWNu69gVcYgdxlmVmzTWnetw=="
		crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>

<body class="min-h-screen flex items-center justify-center bg-gradient-to-br from-orange-50 via-white to-orange-100">
	<!-- Card -->
	<div class="w-full max-w-md bg-white shadow-2xl rounded-3xl p-10 relative">

		<!-- Logo -->
		<div class="flex justify-center mb-6">
			<img onclick="window.location.href='index.html'" src="images/BarDeli Logo (Black).png" class="h-28 w-28"
				alt="BarDeli Logo">
		</div>

		<!-- Heading -->
		<h1 class="text-3xl font-extrabold text-center text-gray-800 mb-2">Welcome Back</h1>
		<p class="text-center text-gray-500 mb-8">Log in to continue with BarDeli Catering</p>

		<!-- Form -->
		<form id="login-form" class="space-y-6">
			<div>
				<label class="block text-sm font-medium text-gray-700">Email</label>
				<input id="email" type="email" required
					class="mt-1 w-full rounded-xl border border-gray-300 px-4 py-3 shadow-sm focus:outline-none focus:ring-2 focus:ring-brand focus:border-brand transition" />
			</div>

			<div>
				<label class="block text-sm font-medium text-gray-700">Password</label>
				<input id="password" type="password" required
					class="mt-1 w-full rounded-xl border border-gray-300 px-4 py-3 shadow-sm focus:outline-none focus:ring-2 focus:ring-brand focus:border-brand transition" />
			</div>

			<!-- Show Password -->
			<div class="flex items-center justify-between">
				<label class="inline-flex items-center space-x-2">
					<input id="show_pw" type="checkbox" class="text-brand focus:ring-brand">
					<span class="text-sm text-gray-600">Show password</span>
				</label>
				<a href="#" class="text-sm text-brand hover:underline">Forgot password?</a>
			</div>

			<!-- Submit Button -->
			<button id="loginBtn" type="submit"
				class="w-full py-3 rounded-xl bg-brand text-white font-semibold shadow-lg hover:bg-orange-700 hover:shadow-xl transition transform hover:-translate-y-0.5">
				<i class="fa-solid fa-arrow-right-to-bracket"></i> Log In
			</button>

			<!-- Sign Up Link -->
			<p class="text-sm text-center mt-6 text-gray-600">
				Don’t have an account?
				<a href="signup.html" class="font-semibold text-brand hover:text-orange-700">Sign up</a>
			</p>
		</form>
	</div>

	<!-- Login with Supabase auth -->
	<script type="module">
		import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

		const supabaseUrl = 'https://fawlfsukrqrucrrxrjvq.supabase.co'
		const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZhd2xmc3VrcnFydWNycnhyanZxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU0MzU2OTUsImV4cCI6MjA3MTAxMTY5NX0.KGH5SAJvCEhnz3NHdp6LeMgCvZp-nP1Tj6oIL32J6K8'

		const supabase = createClient(supabaseUrl, supabaseKey)

		// Toggle password visibility
		document.getElementById('show_pw').addEventListener('change', (e) => {
			document.getElementById('password').type = e.target.checked ? 'text' : 'password';
		});

		// Handle login form submit
		document.getElementById('login-form').addEventListener('submit', async (event) => {
			event.preventDefault(); // prevent page reload
			await login();
		});

		async function login() {
			const email = document.getElementById("email").value.trim();
			const password = document.getElementById("password").value.trim();

			if (!email || !password) {
				alert("Please enter both email and password");
				return;
			}

			try {
				// 1️⃣ Sign in with Supabase Auth
				const { data: authData, error: authError } = await supabase.auth.signInWithPassword({
					email,
					password
				});

				if (authError) throw authError;

				document.getElementById('loginBtn').textContent = 'Loggin In...';

				// 2️⃣ Fetch user info from your users table
				const { data: userData, error: userError } = await supabase
					.from('users')
					.select('*')
					.eq('auth_user_id', authData.user.id)
					.single();

				if (userError) throw userError;

				alert("Login Successful!!!")

				// 3️⃣ Store session info in localStorage (optional)
				localStorage.setItem("user", JSON.stringify({
					id: userData.id,
					email: email,
					first_name: userData.first_name,
					last_name: userData.last_name,
					role: userData.role
				}));

				// 4️⃣ Redirect based on role
				if (userData.role === "Customer") {
					window.location.href = './html_pages/Customer/customerhomepage.html';
				} else if (userData.role === "Admin") {
					window.location.href = './admin/admin-dashboard.html';
				} else {
					alert("Unknown role. Please contact support.");
				}

			} catch (err) {
				console.error('Login error:', err);
				alert('Login failed: ' + err.message);
			}
		}
	</script>

</body>

</html>
