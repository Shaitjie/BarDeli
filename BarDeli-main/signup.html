<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bardeli Sign Up</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="font-sans">

    <!-- Navbar -->
    <nav class="fixed top-0 left-0 w-full bg-[#d35400] flex justify-between items-center h-20 z-50 shadow-md px-5">
        <div class="flex items-center">
            <img src="./images/BarDeli Logo (White).png" alt="Company Logo" class="h-20 mr-2">
            <span class="hidden">üçΩÔ∏è BarDeli Catering</span>
        </div>
    </nav>

    <!-- Sign Up Section -->
    <div class="w-full mt-28 flex justify-center">
        <div class="w-4/5 bg-[#d35400] inline-block rounded-2xl text-left px-64 pt-1 pb-8">
            <h1 class="text-5xl font-extrabold text-center text-white">Sign Up</h1>

            <div class="signup-inputs">
                <form id="signupForm" class="w-full">

                    <p class="text-lg mt-8 font-extrabold text-white">Full Name:</p>
                    <input type="text" id="fullname" placeholder="Please enter your name and surname"
                        class="w-full h-9 rounded-full border border-black text-lg px-4 font-semibold" required>

                    <p class="text-lg mt-8 font-extrabold text-white">Phone:</p>
                    <input type="tel" id="phone" placeholder="Please enter your phone number, eg: 079 121 2348"
                        class="w-full h-9 rounded-full border border-black text-lg px-4 font-semibold" required>

                    <p class="text-lg mt-8 font-extrabold text-white">Role:</p>
                    <select id="role" required class="text-xl mb-2 rounded-lg px-3 py-1">
                        <option value="Customer" class="text-base">Customer</option>
                    </select>

                    <p class="text-lg mt-8 font-extrabold text-white">Email:</p>
                    <input type="email" id="email" placeholder="Please enter your email"
                        class="w-full h-9 rounded-full border border-black text-lg px-4 font-semibold" required>

                    <p class="text-lg mt-8 font-extrabold text-white">Password:</p>
                    <input type="password" id="password" placeholder="Please enter a password"
                        class="w-full h-9 rounded-full border border-black text-lg px-4 font-semibold" required>

                    <div class="flex items-center gap-2 text-white mt-4">
                        <input type="checkbox" id="password-chkbox" onclick="showPassword()" class="w-5 h-7">
                        <label for="password-chkbox" class="text-base font-extrabold">Show Password</label>
                    </div>
                </form>

                <!-- Button -->
                <div class="w-full mt-8">
                    <button id="signup"
                        class="w-full h-20 text-5xl font-extrabold rounded-2xl text-[#d35400] bg-white border border-transparent transition duration-300 hover:text-white hover:bg-[#d35400] hover:border-white">
                        Sign Up
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer
        class="fixed bottom-0 w-full bg-[#d35400] text-white text-center py-4 h-20 flex justify-center items-center">
        <p class="text-2xl md:text-3xl font-extrabold">¬© 2025 Bardeli Catering</p>
    </footer>

    <!-- Password toggle -->
    <script>
        function showPassword() {
            let x = document.getElementById("password");
            x.type = x.type === "password" ? "text" : "password";
        }
    </script>
 
    <!--Supabase signup with auth -->
    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

        const supabaseUrl = 'https://fawlfsukrqrucrrxrjvq.supabase.co'
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZhd2xmc3VrcnFydWNycnhyanZxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU0MzU2OTUsImV4cCI6MjA3MTAxMTY5NX0.KGH5SAJvCEhnz3NHdp6LeMgCvZp-nP1Tj6oIL32J6K8'
        const supabase = createClient(supabaseUrl, supabaseKey)

        document.addEventListener('DOMContentLoaded', () => {
            const signupButton = document.getElementById('signup')
            const fullname = document.getElementById('fullname')
            const phone = document.getElementById('phone')
            const role = document.getElementById('role')
            const email = document.getElementById('email')
            const password = document.getElementById('password')

            // Show/hide password
            document.getElementById("password-chkbox").addEventListener("click", () => {
            password.type = password.type === "password" ? "text" : "password"
            })

            signupButton.addEventListener('click', async (e) => {
            e.preventDefault()

            if (!fullname.value || !phone.value || !email.value || !password.value) {
                alert('Please fill in all fields')
                return
            }

            signupButton.disabled = true
            signupButton.textContent = 'Signing up...'

            try {
                // 1Ô∏è‚É£ Create user in Supabase Auth
                const { data: authData, error: authError } = await supabase.auth.signUp({
                email: email.value,
                password: password.value
                })

                if (authError) throw authError

                // 2Ô∏è‚É£ Insert user details into your 'users' table
                const { data, error } = await supabase
                .from('users')
                .insert([{
                    auth_user_id: authData.user.id,
                    fullname: fullname.value,
                    phone: phone.value,
                    role: role.value
                }])

                if (error) throw error

                alert('Signup successful! Redirecting to login...')
                window.location.href = "login.html"

            } catch (err) {
                console.error('Signup error:', err)
                alert('Signup failed: ' + err.message)
            } finally {
                signupButton.disabled = false
                signupButton.textContent = 'Sign Up'
            }
            })
        })
    </script>
</body>
</html>